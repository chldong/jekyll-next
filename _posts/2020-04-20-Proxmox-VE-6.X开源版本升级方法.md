---
layout: post
title: "PVE开源版升级方法"
date: 2020-04-20
---
<!-- TOC -->

- [PVE开源版升级方法](#pve%E5%BC%80%E6%BA%90%E7%89%88%E5%8D%87%E7%BA%A7%E6%96%B9%E6%B3%95)
    - [第一步：注释掉企业版升级源](#%E7%AC%AC%E4%B8%80%E6%AD%A5%E6%B3%A8%E9%87%8A%E6%8E%89%E4%BC%81%E4%B8%9A%E7%89%88%E5%8D%87%E7%BA%A7%E6%BA%90)
    - [第二步：更换Debian为国内源，并增加官方免费版升级源](#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E6%9B%B4%E6%8D%A2debian%E4%B8%BA%E5%9B%BD%E5%86%85%E6%BA%90%E5%B9%B6%E5%A2%9E%E5%8A%A0%E5%AE%98%E6%96%B9%E5%85%8D%E8%B4%B9%E7%89%88%E5%8D%87%E7%BA%A7%E6%BA%90)
    - [第三步，添加官方免费版更新源](#%E7%AC%AC%E4%B8%89%E6%AD%A5%E6%B7%BB%E5%8A%A0%E5%AE%98%E6%96%B9%E5%85%8D%E8%B4%B9%E7%89%88%E6%9B%B4%E6%96%B0%E6%BA%90)
    - [第四步：拿到官方开源授权文件](#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E6%8B%BF%E5%88%B0%E5%AE%98%E6%96%B9%E5%BC%80%E6%BA%90%E6%8E%88%E6%9D%83%E6%96%87%E4%BB%B6)
    - [第五步：进行升级](#%E7%AC%AC%E4%BA%94%E6%AD%A5%E8%BF%9B%E8%A1%8C%E5%8D%87%E7%BA%A7)
    - [附：官方文档](#%E9%99%84%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3)

<!-- /TOC -->

## PVE开源版升级方法

![Proxmox-VE](https://pve.proxmox.com/mediawiki/images/thumb/f/f9/Proxmox-VE-5-4-Cluster-Summary.png/600px-Proxmox-VE-5-4-Cluster-Summary.png)

### 第一步：注释掉企业版升级源

```bash
vim /etc/apt/sources.list.d/pve-enterprise.list
#注释掉企业版这一行
#deb https://enterprise.proxmox.com/debian/pve stretch pve-enterprise
#也可以直接删除这个文件
rm -f /etc/apt/sources.list.d/pve-enterprise.list
``` 

### 第二步：更换Debian为国内源，并增加官方免费版升级源

```bash
nano /etc/apt/sources.list
#备份后清空内容
#添加以下内容

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
#下面这一条是相对稳定的版本，官方不建议一般用户使用测试版升级源
deb http://download.proxmox.com/debian stretch pve-no-subscription

```

### 第三步，添加官方免费版更新源

```bash
echo "deb http://download.proxmox.com/debian/pve stretch pve-no-subscription" > /etc/apt/sources.list.d/pve-install-repo.list
```

### 第四步：拿到官方开源授权文件

```bash
#5.x版本
wget http://download.proxmox.com/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg
#6.x版本
wget http://download.proxmox.com/debian/proxmox-ve-release-6.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-6.x.gpg
```
 
### 第五步：进行升级

```bash
apt update && apt dist-upgrade
```
 

### 附：官方文档

https://pve.proxmox.com/wiki/Install_Proxmox_VE_on_Debian_Stretch

升级完成后，可以执行pveversion -v查看下最新的软件版本。然后执行reboot重启物理服务器